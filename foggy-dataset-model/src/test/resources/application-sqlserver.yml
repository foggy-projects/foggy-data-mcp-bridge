# ============================================
# Foggy Dataset Model - SQL Server 测试环境配置
# 文件: application-sqlserver.yml
# 使用方法: --spring.profiles.active=sqlserver
# 启动数据库: docker-compose -f docker-compose.test.yml up -d sqlserver-test
# 注意: SQL Server 需要手动执行初始化脚本
# ============================================

spring:
  application:
    name: foggy-dataset-model-test

  # ==========================================
  # SQL Server 数据源配置
  # ==========================================
  datasource:
    url: jdbc:sqlserver://localhost:11433;databaseName=foggy_test;encrypt=false;trustServerCertificate=true
    username: sa
    password: Foggy_Test_123!
    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
    # HikariCP 连接池配置
    hikari:
      pool-name: FoggyTestHikariCP-SqlServer
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1

  # ==========================================
  # JPA 配置
  # ==========================================
  jpa:
    hibernate:
      ddl-auto: none  # 使用 Docker 初始化脚本创建表
    properties:
      hibernate:
        jdbc:
          time_zone: Asia/Shanghai
        dialect: org.hibernate.dialect.SQLServer2012Dialect
    open-in-view: false

# ==========================================
# 日志配置
# ==========================================
logging:
  level:
    root: INFO
    org.springframework.jdbc: DEBUG
    org.springframework.jdbc.core.JdbcTemplate: DEBUG
    org.springframework.jdbc.core.StatementCreatorUtils: TRACE
    com.foggyframework: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# ==========================================
# Foggy Dataset 配置
# ==========================================
foggy:
  dataset:
    # SQL 日志配置
    show-sql: true               # 打印 SQL 语句
    sql-format: false            # SQL 格式化（单行显示）
    sql-log-level: DEBUG         # SQL 日志级别
    show-sql-parameters: true    # 显示 SQL 参数
    show-execution-time: true    # 显示执行时间
    # 模型定义文件路径
    templates-path: classpath:/foggy/templates/
    # 缓存配置
    cache:
      enabled: true
      ttl: 3600
    # 查询限制
    query:
      max-rows: 10000
      timeout: 30000

# ==========================================
# 测试专用配置
# ==========================================
test:
  database:
    type: sqlserver
    version: "2022"
  data:
    generate-on-startup: false
    cleanup-after-test: false
