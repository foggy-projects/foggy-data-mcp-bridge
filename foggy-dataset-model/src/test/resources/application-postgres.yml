# ============================================
# Foggy Dataset Model - PostgreSQL 测试环境配置
# 文件: application-postgres.yml
# 使用方法: --spring.profiles.active=postgres
# 启动数据库: docker-compose -f docker-compose.test.yml up -d postgres-test
# ============================================

spring:
  application:
    name: foggy-dataset-model-test

  # ==========================================
  # PostgreSQL 数据源配置
  # ==========================================
  datasource:
    url: jdbc:postgresql://localhost:15432/foggy_test?currentSchema=public
    username: foggy
    password: foggy_test_123
    driver-class-name: org.postgresql.Driver
    # HikariCP 连接池配置
    hikari:
      pool-name: FoggyTestHikariCP-Postgres
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1

  # ==========================================
  # JPA 配置
  # ==========================================
  jpa:
    hibernate:
      ddl-auto: none  # 使用 Docker 初始化脚本创建表
    properties:
      hibernate:
        jdbc:
          time_zone: Asia/Shanghai
        dialect: org.hibernate.dialect.PostgreSQL95Dialect
    show-sql: true
    open-in-view: false

# ==========================================
# 日志配置
# ==========================================
logging:
  level:
    root: INFO
    org.springframework.jdbc: DEBUG
    org.springframework.jdbc.core.JdbcTemplate: DEBUG
    org.springframework.jdbc.core.StatementCreatorUtils: TRACE
    com.foggyframework: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# ==========================================
# Foggy Dataset 配置
# ==========================================
foggy:
  dataset:
    # 模型定义文件路径
    templates-path: classpath:/foggy/templates/
    # 缓存配置
    cache:
      enabled: true
      ttl: 3600
    # 查询限制
    query:
      max-rows: 10000
      timeout: 30000

# ==========================================
# 测试专用配置
# ==========================================
test:
  database:
    type: postgresql
    version: "15"
  data:
    generate-on-startup: false
    cleanup-after-test: false
