# ============================================
# Foggy Dataset Model - SQLite 测试环境配置
# 文件: application-sqlite.yml
# 使用方法: --spring.profiles.active=sqlite
# 说明: SQLite 为嵌入式数据库，无需 Docker
# ============================================

spring:
  application:
    name: foggy-dataset-model-test

  # ==========================================
  # SQLite 数据源配置
  # ==========================================
  datasource:
    # 使用共享内存数据库，所有连接共享同一个数据库
    url: jdbc:sqlite:file::memory:?cache=shared
    driver-class-name: org.sqlite.JDBC
    # HikariCP 连接池配置
    hikari:
      pool-name: FoggyTestHikariCP-SQLite
      # SQLite 内存模式需要保持至少一个连接存活
      minimum-idle: 1
      maximum-pool-size: 5
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1

  # ==========================================
  # JPA 配置
  # ==========================================
  jpa:
    hibernate:
      ddl-auto: none  # 使用初始化脚本创建表
    properties:
      hibernate:
        dialect: org.hibernate.community.dialect.SQLiteDialect
    open-in-view: false

  # ==========================================
  # 初始化脚本配置 (SQLite 使用)
  # ==========================================
  sql:
    init:
      mode: always
      schema-locations: classpath:sqlite/01-schema.sql
      data-locations: classpath:sqlite/02-dict-data.sql,classpath:sqlite/03-test-data.sql

# ==========================================
# 日志配置
# ==========================================
logging:
  level:
    root: INFO
    org.springframework.jdbc: DEBUG
    org.springframework.jdbc.core.JdbcTemplate: DEBUG
    org.springframework.jdbc.core.StatementCreatorUtils: TRACE
    com.foggyframework: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# ==========================================
# Foggy Dataset 配置
# ==========================================
foggy:
  dataset:
    # SQL 日志配置
    show-sql: true               # 打印 SQL 语句
    sql-format: false            # SQL 格式化（单行显示）
    sql-log-level: DEBUG         # SQL 日志级别
    show-sql-parameters: true    # 显示 SQL 参数
    show-execution-time: true    # 显示执行时间
    # 模型定义文件路径
    templates-path: classpath:/foggy/templates/
    # 缓存配置
    cache:
      enabled: true
      ttl: 3600
    # 查询限制
    query:
      max-rows: 10000
      timeout: 30000

# ==========================================
# 测试专用配置
# ==========================================
test:
  database:
    type: sqlite
    version: "3.30+"
  data:
    generate-on-startup: false
    cleanup-after-test: false
